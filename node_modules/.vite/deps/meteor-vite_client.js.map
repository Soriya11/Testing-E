{
  "version": 3,
  "sources": ["../../meteor-vite/package.json", "../../meteor-vite/src/client/ValidateStub.ts"],
  "sourcesContent": ["{\n  \"name\": \"meteor-vite\",\n  \"version\": \"1.10.4\",\n  \"description\": \"\",\n  \"files\": [\n    \"dist\"\n  ],\n  \"main\": \"\",\n  \"exports\": {\n    \"./plugin\": {\n      \"import\": [\n        \"./dist/plugin/index.mjs\"\n      ],\n      \"require\": [\n        \"./dist/plugin/index.js\"\n      ]\n    },\n    \"./client\": \"./dist/client/index.mjs\"\n  },\n  \"scripts\": {\n    \"start\": \"ts-node-dev src/bin/debug/watch-mocks.ts\",\n    \"watch\": \"tsup --watch --dts --sourcemap\",\n    \"build\": \"rm -rf ./dist && tsup-node\",\n    \"prepare\": \"npm run build\",\n    \"test\": \"vitest\"\n  },\n  \"tsup\": [\n    {\n      \"entry\": [\n        \"./src/bin/worker.ts\",\n        \"./src/client/index.ts\"\n      ],\n      \"outDir\": \"dist\",\n      \"format\": \"esm\",\n      \"sourcemap\": true,\n      \"dts\": false\n    },\n    {\n      \"entry\": [\n        \"./src/plugin/index.ts\"\n      ],\n      \"outDir\": \"dist/plugin\",\n      \"format\": [\n        \"cjs\",\n        \"esm\"\n      ],\n      \"sourcemap\": true,\n      \"dts\": true\n    }\n  ],\n  \"typesVersions\": {\n    \"*\": {\n      \"plugin\": [\n        \"./dist/plugin/index.d.mts\",\n        \"./dist/plugin/index.d.ts\"\n      ],\n      \"client\": [\n        \"./dist/client/index.d.mts\"\n      ]\n    }\n  },\n  \"keywords\": [\n    \"meteor\",\n    \"vite\"\n  ],\n  \"author\": \"\",\n  \"bugs\": {\n    \"url\": \"https://github.com/JorgenVatle/meteor-vite/issues\"\n  },\n  \"homepage\": \"https://github.com/JorgenVatle/meteor-vite#readme\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"@babel/parser\": \"^7.22.5\",\n    \"@babel/traverse\": \"^7.22.5\",\n    \"p-limit\": \"^3.1.0\",\n    \"picocolors\": \"^1.0.0\"\n  },\n  \"peerDependencies\": {\n    \"vite\": \">=3.0.0 < 5.0.0\"\n  },\n  \"devDependencies\": {\n    \"@babel/generator\": \"^7.23.6\",\n    \"@babel/types\": \"^7.22.5\",\n    \"@sveltejs/vite-plugin-svelte\": \"^2.4.2\",\n    \"@types/babel__generator\": \"^7.6.8\",\n    \"@types/node\": \"^20.3.3\",\n    \"ts-node-dev\": \"^2.0.0\",\n    \"tsup\": \"^7.1.0\",\n    \"typescript\": \"^5.1.6\",\n    \"vite\": \"^4.4.3\",\n    \"vitest\": \"^0.32.2\"\n  }\n}\n", "import PackageJson from '../../package.json';\nimport type { StubValidationSettings } from '../VitePluginSettings';\n\n\n/**\n * Validate that the provided stub export key maps to a working export.\n * This is quite important we do. If vite:bundler doesn't properly parse a given package, its exports will just\n * silently fail and remain undefined, without any clear warning or indication as to what's going on.\n *\n * TODO: Attempt to emit a warning directly to the server console from the client. (development environment only)\n * TODO: Import, validate, and re-export wildcard re-exports.\n * TODO: Read expected 'typeof' value from package exports at the parser and compare against the expected type\n * rather than just an undefined check.\n */\nexport function validateStub(stubbedPackage: any, { exportKeys, packageName, requestId, warnOnly }: StubValidatorOptions) {\n    console.debug('Meteor-Vite package validation:', {\n        packageName,\n        stubbedPackage,\n        exportKeys,\n        warnOnly,\n    });\n    \n    const errors: Error[] = [];\n    \n    exportKeys.forEach((key) => {\n        if (!stubbedPackage) {\n            errors.push(new ImportException(`Was not able to import Meteor package: \"${packageName}\"`, {\n                requestId: requestId,\n                packageName,\n            }))\n        }\n        if (typeof stubbedPackage[key] === 'undefined') {\n            errors.push(new UndefinedExportException(`Could not import Meteor package into the client: export '${key}' is undefined`, {\n                requestId: requestId,\n                packageName,\n                exportName: key,\n            }))\n        }\n    });\n    \n    errors.forEach((error, i) => {\n        if (warnOnly) {\n            return console.warn(error);\n        }\n        if (errors.length - 1 >= i) {\n            throw error;\n        }\n        console.error(error);\n    })\n    \n}\n\nclass MeteorViteError extends Error {\n    constructor(message: string, { packageName, requestId, exportName }: ErrorMetadata) {\n        const footerLines = [\n            `‚ö° Affected package: ${packageName}`,\n            `‚ö° Export name: { ${exportName} }`,\n            `‚ö° Vite Request ID: ${requestId}`,\n            '',\n            `‚ö†Ô∏è Open an issue - it's likely an issue with meteor-vite rather than '${packageName}'`,\n            `    ${PackageJson.bugs.url}`,\n            '',\n            `üîì  At your own risk, you can disable validation for the '${packageName}' package`,\n            `    This may allow the app to continue running, but can lead to other things breaking.`,\n            `    ${PackageJson.homepage}#stub-validation`,\n        ].join('\\n')\n        \n        super(message);\n        this.name = `[meteor-vite] ‚ö†Ô∏è ${this.constructor.name}`\n        this.stack += `\\n\\n${footerLines}`\n    }\n}\n\nclass ImportException extends MeteorViteError {}\nclass UndefinedExportException extends MeteorViteError {}\n\ntype ErrorMetadata = Pick<StubValidatorOptions, 'packageName' | 'requestId'> & { exportName?: string };\n\nexport interface StubValidatorOptions extends Pick<StubValidationSettings, 'warnOnly'>{\n    requestId: string;\n    packageName: string;\n    \n    /**\n     * Name of every export to validate for the provided stub.\n     * export {}\n     */\n    exportKeys: string[];\n}"],
  "mappings": ";;;AAAA,IAAA,kBAAA;EACE,MAAQ;EACR,SAAW;EACX,aAAe;EACf,OAAS;IACP;EACF;EACA,MAAQ;EACR,SAAW;IACT,YAAY;MACV,QAAU;QACR;MACF;MACA,SAAW;QACT;MACF;IACF;IACA,YAAY;EACd;EACA,SAAW;IACT,OAAS;IACT,OAAS;IACT,OAAS;IACT,SAAW;IACX,MAAQ;EACV;EACA,MAAQ;IACN;MACE,OAAS;QACP;QACA;MACF;MACA,QAAU;MACV,QAAU;MACV,WAAa;MACb,KAAO;IACT;IACA;MACE,OAAS;QACP;MACF;MACA,QAAU;MACV,QAAU;QACR;QACA;MACF;MACA,WAAa;MACb,KAAO;IACT;EACF;EACA,eAAiB;IACf,KAAK;MACH,QAAU;QACR;QACA;MACF;MACA,QAAU;QACR;MACF;IACF;EACF;EACA,UAAY;IACV;IACA;EACF;EACA,QAAU;EACV,MAAQ;IACN,KAAO;EACT;EACA,UAAY;EACZ,SAAW;EACX,cAAgB;IACd,iBAAiB;IACjB,mBAAmB;IACnB,WAAW;IACX,YAAc;EAChB;EACA,kBAAoB;IAClB,MAAQ;EACV;EACA,iBAAmB;IACjB,oBAAoB;IACpB,gBAAgB;IAChB,gCAAgC;IAChC,2BAA2B;IAC3B,eAAe;IACf,eAAe;IACf,MAAQ;IACR,YAAc;IACd,MAAQ;IACR,QAAU;EACZ;AACF;;;AC9EO,SAAS,aAAa,gBAAqB,EAAE,YAAY,aAAa,WAAW,SAAS,GAAyB;AACtH,UAAQ,MAAM,mCAAmC;IAC7C;IACA;IACA;IACA;EACJ,CAAC;AAED,QAAM,SAAkB,CAAC;AAEzB,aAAW,QAAQ,CAAC,QAAQ;AACxB,QAAI,CAAC,gBAAgB;AACjB,aAAO,KAAK,IAAI,gBAAgB,2CAA2C,gBAAgB;QACvF;QACA;MACJ,CAAC,CAAC;IACN;AACA,QAAI,OAAO,eAAe,SAAS,aAAa;AAC5C,aAAO,KAAK,IAAI,yBAAyB,4DAA4D,qBAAqB;QACtH;QACA;QACA,YAAY;MAChB,CAAC,CAAC;IACN;EACJ,CAAC;AAED,SAAO,QAAQ,CAAC,OAAO,MAAM;AACzB,QAAI,UAAU;AACV,aAAO,QAAQ,KAAK,KAAK;IAC7B;AACA,QAAI,OAAO,SAAS,KAAK,GAAG;AACxB,YAAM;IACV;AACA,YAAQ,MAAM,KAAK;EACvB,CAAC;AAEL;AAEA,IAAM,kBAAN,cAA8B,MAAM;EAChC,YAAY,SAAiB,EAAE,aAAa,WAAW,WAAW,GAAkB;AAChF,UAAM,cAAc;MAChB,4BAAuB;MACvB,yBAAoB;MACpB,2BAAsB;MACtB;MACA,mFAAyE;MACzE,OAAO,gBAAY,KAAK;MACxB;MACA,oEAA6D;MAC7D;MACA,OAAO,gBAAY;IACvB,EAAE,KAAK,IAAI;AAEX,UAAM,OAAO;AACb,SAAK,OAAO,8BAAoB,KAAK,YAAY;AACjD,SAAK,SAAS;;EAAO;EACzB;AACJ;AAEA,IAAM,kBAAN,cAA8B,gBAAgB;AAAC;AAC/C,IAAM,2BAAN,cAAuC,gBAAgB;AAAC;",
  "names": []
}
